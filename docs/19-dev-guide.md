# 开发规范与流程（参考版）

> 本文聚焦“怎么做”：代码协作、质量标准与交付流程。与 [`docs/06-contribution.md`](06-contribution.md) 互补，若项目已有更严格规范，以项目规范为准。

## 1. 适用范围
- 适用于夜莺社区所有代码仓库与产品服务
- 目标是降低协作成本、避免返工、保证可交付

## 2. 仓库与分支策略
- **社区仓库**：仅维护 `main` 与发布 `tag`（`vX.Y.Z`）
- **个人仓库**：通过 `fork` 参与，保持 `main` 与上游同步
- **合并规则**：禁止直接向社区 `main` 推送代码，仅接受 PR
- **分支命名建议**：`feat/xxx`、`fix/xxx`、`docs/xxx`、`chore/xxx`

## 3. PR 合并流程（建议）
1) Issue 描述目标与范围（如已有 Issue，PR 必须关联）
2) Fork → clone → 创建分支开发
3) 本地自测（必要时提供复现或测试步骤）
4) 提交 PR，说明影响范围/风险/测试方式
5) Maintainer 评审 → 合并
6) 同步上游 `main`，保持个人仓库最新

## 4. Issue / 需求 / Bug 结构（建议字段）
**功能需求**
- 背景与问题
- 业务价值
- 验收标准
- 技术方案（可选）
- 工作量预估
- 相关资源（设计/原型/链接）

**Bug**
- 复现步骤
- 预期行为 / 实际行为
- 环境信息（设备/版本/角色）
- 日志/截图
- 优先级评估（P0-P3）

**模板位置**
- Issue 模板：`.github/ISSUE_TEMPLATE/`
- PR 模板：`.github/pull_request_template.md`

## 5. Commit 规范
**格式**
```
<type>(scope?): <short summary>

[optional body]

[optional footer(s)]
```

**类型（type）**
- `feat` 新增功能
- `fix` 修复问题
- `docs` 文档变更
- `style` 格式调整（不影响逻辑）
- `refactor` 代码重构
- `test` 测试相关
- `chore` 构建/依赖/脚本等杂项

**规则**
- `summary` 尽量 ≤ 72 字符，描述“做了什么”
- 需要时在 footer 中关联 Issue 或标注 BREAKING CHANGE

## 6. 接口分类与版本
- **public**：面向第三方与客户端，需长期稳定
- **admin**：运营/管理员权限，影响资金/权限/合规
- **internal**：服务间调用或内部作业，可快速迭代
- **归类原则**：一个接口只能归属一种类别
- **兼容性**：不兼容变更需升级路径版本（如 `/api/v2/...`）

## 7. 格式化与换行符
- 统一使用 LF，避免跨平台提交带来的噪音差异
- 如使用 Windows，可通过 Git 配置或 `.gitattributes` 统一换行策略

## 8. README 与文档要求
- README 建议包含：项目简介 / 功能特性 / 快速开始 / 配置说明 / 本地开发 / 部署 / API / 测试 / 贡献
- 文档统一放在 `docs/`，建议使用 Mermaid 绘图
- 如涉及升级风险，建议维护版本变更说明（例如 `versions.md`）记录影响

## 9. CI 与测试最低标准（建议）
- PR 必须说明测试情况：已测试/未测试（未测需说明原因）
- 项目已有测试时，至少运行现有测试；若无测试，需提供可复现的手动验证步骤
- 构建或启动脚本若存在，应能在干净环境通过（必要时提供日志）
- 影响 API/数据结构的变更需同步文档与示例

**CI 建议**
- PR 阶段至少包含：lint（如有）、test（如有）、build（如有）
- 关键改动应有维护者复审

## 10. 开发 / 测试 / 生产流程（建议）
**开发阶段**
- 本地或开发机验证可运行
- README 可复现部署流程
- 提供最小配置说明
- 配置模板保持一套，开发/测试/生产只替换环境值
- 重要脚本建议在“干净目录/新克隆”环境复验

**测试阶段**
- 以 `main` 为基线，确保环境跟随最新代码
- 自动化构建与升级（如有）
- 变更需在版本变更说明中记录影响

**生产阶段**
- 运维负责部署与配置
- 优先容器化与脚本化升级
- 避免人工直接修改配置

## 11. 打包与交付（适用于可独立部署项目）
- 启动脚本：`scripts/starter.sh` 支持 `start|stop|restart`
- 打包脚本：`scripts/package.sh` 输出到 `output/`
- 包含：二进制 / 配置模板 / 静态资源 / 启动脚本
- 命名规则：`<project>-YYYYMMDD-HHMMSS-<shortsha>.tar.gz`（小写）
- `output/` 需加入 `.gitignore`
- 打包完成后应在新目录解压并验证可启动

## 12. 云上环境与安全（如涉及）
- 提供 SSH 公钥申请访问权限
- 禁止 root 密码登录，使用密钥登录
- 云资源需登记与交接，避免资产丢失

## 13. 工具建议
- IDE：VS Code（按语言安装格式化/语法插件）
- 规范驱动开发：先文档后实现，必要时引入 SDD 流程
